"""Скрипт для инициализации мест в БД"""
import sys
import os

# Добавляем путь к приложению
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from sqlalchemy.orm import Session
from app.db.base import SessionLocal, engine
from app.models import Base, Place

# Создаём таблицы
Base.metadata.create_all(bind=engine)

# Данные мест из старого проекта
PLACES_DATA = [
    {
        "title": "Красная площадь",
        "description": "Главная площадь Москвы, символ России. Здесь находятся Кремль, Собор Василия Блаженного и Мавзолей Ленина.",
        "lat": 55.7539,
        "lon": 37.6208,
        "category": "Достопримечательность",
        "region": "Москва"
    },
    {
        "title": "Эрмитаж",
        "description": "Один из крупнейших художественных музеев мира, расположенный в Санкт-Петербурге. Более 3 миллионов экспонатов.",
        "lat": 59.9398,
        "lon": 30.3146,
        "category": "Музей",
        "region": "Санкт-Петербург"
    },
    {
        "title": "Озеро Байкал",
        "description": "Самое глубокое озеро в мире, объект Всемирного наследия ЮНЕСКО. Уникальная природа и чистейшая вода.",
        "lat": 53.4125,
        "lon": 108.1681,
        "category": "Природа",
        "region": "Иркутская область"
    },
    {
        "title": "Кижи",
        "description": "Музей-заповедник деревянного зодчества на острове в Онежском озере. Знаменит Преображенской церковью.",
        "lat": 62.0667,
        "lon": 35.2167,
        "category": "Достопримечательность",
        "region": "Карелия"
    },
    {
        "title": "Долина гейзеров",
        "description": "Единственное гейзерное поле в Евразии, расположенное на Камчатке. Уникальная природная достопримечательность.",
        "lat": 54.4306,
        "lon": 160.1394,
        "category": "Природа",
        "region": "Камчатка"
    },
    {
        "title": "Мамаев курган",
        "description": "Мемориальный комплекс в Волгограде, посвящённый Сталинградской битве. Главный монумент — «Родина-мать зовёт!»",
        "lat": 48.7425,
        "lon": 44.537,
        "category": "Достопримечательность",
        "region": "Волгоград"
    },
    {
        "title": "Собор Василия Блаженного",
        "description": "Православный храм на Красной площади в Москве, один из самых узнаваемых символов России.",
        "lat": 55.7525,
        "lon": 37.6231,
        "category": "Достопримечательность",
        "region": "Москва"
    },
    {
        "title": "Петергоф",
        "description": "Дворцово-парковый ансамбль под Санкт-Петербургом, знаменитый своими фонтанами и парками.",
        "lat": 59.8833,
        "lon": 29.9,
        "category": "Достопримечательность",
        "region": "Санкт-Петербург"
    },
    {
        "title": "Кунгурская пещера",
        "description": "Одна из самых известных пещер Урала. Подземные озёра, сталактиты и сталагмиты создают фантастический пейзаж.",
        "lat": 57.4333,
        "lon": 57.0,
        "category": "Природа",
        "region": "Пермский край"
    },
    {
        "title": "Алтайские горы",
        "description": "Горная система на юге Сибири с уникальной природой, чистыми озёрами и богатой флорой и фауной.",
        "lat": 50.0,
        "lon": 86.0,
        "category": "Природа",
        "region": "Алтай"
    },
    {
        "title": "Сочи",
        "description": "Курортный город на Чёрном море, столица зимних Олимпийских игр 2014 года. Пляжи, горы и парки.",
        "lat": 43.6028,
        "lon": 39.7342,
        "category": "Курорт",
        "region": "Краснодарский край"
    },
    {
        "title": "Калининград",
        "description": "Западный форпост России, бывший Кёнигсберг. Уникальная архитектура и история, связанная с Пруссией.",
        "lat": 54.7104,
        "lon": 20.4522,
        "category": "Достопримечательность",
        "region": "Калининград"
    },
    {
        "title": "Казанский Кремль",
        "description": "Историческая крепость в Казани, объект Всемирного наследия ЮНЕСКО. Симбиоз русской и татарской культур.",
        "lat": 55.7989,
        "lon": 49.1053,
        "category": "Достопримечательность",
        "region": "Казань"
    },
    {
        "title": "Золотое кольцо России",
        "description": "Туристический маршрут по древним городам: Сергиев Посад, Переславль-Залесский, Ростов, Ярославль и другие.",
        "lat": 57.6299,
        "lon": 39.8737,
        "category": "Маршрут",
        "region": "Ярославль"
    },
    {
        "title": "Эльбрус",
        "description": "Высочайшая вершина России и Европы (5642 м). Популярное место для альпинизма и горнолыжного спорта.",
        "lat": 43.355,
        "lon": 42.4392,
        "category": "Природа",
        "region": "Кабардино-Балкария"
    }
]


def init_places():
    """Инициализирует места в БД"""
    db: Session = SessionLocal()
    try:
        # Проверяем, есть ли уже места
        existing_count = db.query(Place).count()
        if existing_count > 0:
            print(f"Места уже инициализированы ({existing_count} записей)")
            return
        
        # Добавляем места
        for place_data in PLACES_DATA:
            place = Place(**place_data)
            db.add(place)
        
        db.commit()
        print(f"Успешно добавлено {len(PLACES_DATA)} мест")
    except Exception as e:
        print(f"Ошибка при инициализации мест: {e}")
        db.rollback()
    finally:
        db.close()


if __name__ == "__main__":
    init_places()

